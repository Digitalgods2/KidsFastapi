<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{% block title %}KidsKlassiks AI Story Transformer{% endblock %}</title>
    
    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <!-- Bootstrap Icons -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.0/font/bootstrap-icons.css">
    <!-- Custom CSS -->
    <link href="/static/css/style.css" rel="stylesheet">
    <!-- HTMX -->
    <script src="https://unpkg.com/htmx.org@1.9.10"></script>
    <!-- Alpine.js for reactive components -->
    <script defer src="https://unpkg.com/alpinejs@3.x.x/dist/cdn.min.js"></script>
    
    {% block extra_css %}{% endblock %}
</head>
<body>
    <!-- Navigation -->
    <nav class="navbar navbar-expand-lg navbar-dark bg-primary shadow-sm">
        <div class="container-fluid">
            <a class="navbar-brand d-flex align-items-center" href="/">
                <i class="bi bi-book-half fs-4 me-2"></i>
                <span class="fw-bold">KidsKlassiks</span>
            </a>
            
            <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav">
                <span class="navbar-toggler-icon"></span>
            </button>
            
            <div class="collapse navbar-collapse" id="navbarNav">
                <ul class="navbar-nav me-auto">
                    <li class="nav-item">
                        <a class="nav-link {% if request.url.path == '/' %}active{% endif %}" href="/">
                            <i class="bi bi-house"></i> Home
                        </a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link {% if request.url.path == '/dashboard' %}active{% endif %}" href="/dashboard">
                            <i class="bi bi-speedometer2"></i> Dashboard
                        </a>
                    </li>
                    <li class="nav-item dropdown">
                        <a class="nav-link dropdown-toggle {% if 'books' in request.url.path %}active{% endif %}" href="#" role="button" data-bs-toggle="dropdown">
                            <i class="bi bi-book"></i> Books
                        </a>
                        <ul class="dropdown-menu">
                            <li><a class="dropdown-item" href="/books/import">
                                <i class="bi bi-upload"></i> Import New Book
                            </a></li>
                            <li><a class="dropdown-item" href="/books/library">
                                <i class="bi bi-collection"></i> Browse Library
                            </a></li>
                            <li><hr class="dropdown-divider"></li>
                            <li><a class="dropdown-item" href="/books/gutenberg">
                                <i class="bi bi-globe"></i> Project Gutenberg
                            </a></li>
                        </ul>
                    </li>
                    <li class="nav-item dropdown">
                        <a class="nav-link dropdown-toggle {% if 'adaptations' in request.url.path %}active{% endif %}" href="#" role="button" data-bs-toggle="dropdown">
                            <i class="bi bi-layers"></i> Adaptations
                        </a>
                        <ul class="dropdown-menu">
                            <li><a class="dropdown-item" href="/adaptations/create">
                                <i class="bi bi-plus-circle"></i> New Adaptation
                            </a></li>
                            <li><a class="dropdown-item" href="/adaptations">
                                <i class="bi bi-list"></i> View All
                            </a></li>
                            <li><hr class="dropdown-divider"></li>
                            <li><a class="dropdown-item" href="/adaptations/in-progress">
                                <i class="bi bi-hourglass-split"></i> In Progress
                            </a></li>
                            <li><a class="dropdown-item" href="/adaptations/completed">
                                <i class="bi bi-check-circle"></i> Completed
                            </a></li>
                        </ul>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link {% if request.url.path == '/publish' %}active{% endif %}" href="/publish">
                            <i class="bi bi-file-earmark-pdf"></i> Publish
                        </a>
                    </li>
                </ul>
                
                <ul class="navbar-nav">
                    <!-- Notifications -->
                    <li class="nav-item dropdown me-3">
                        <a class="nav-link position-relative" href="#" role="button" data-bs-toggle="dropdown">
                            <i class="bi bi-bell"></i>
                            {% if notifications_count > 0 %}
                            <span class="position-absolute top-0 start-100 translate-middle badge rounded-pill bg-danger">
                                {{ notifications_count }}
                            </span>
                            {% endif %}
                        </a>
                        <ul class="dropdown-menu dropdown-menu-end">
                            <li><h6 class="dropdown-header">Notifications</h6></li>
                            {% if notifications %}
                                {% for notification in notifications %}
                                <li>
                                    <a class="dropdown-item" href="{{ notification.link }}">
                                        <small class="text-muted">{{ notification.time }}</small><br>
                                        {{ notification.message }}
                                    </a>
                                </li>
                                {% endfor %}
                            {% else %}
                                <li><span class="dropdown-item-text text-muted">No new notifications</span></li>
                            {% endif %}
                        </ul>
                    </li>
                    
                    <!-- Settings -->
                    <li class="nav-item">
                        <a class="nav-link {% if request.url.path == '/settings' %}active{% endif %}" href="/settings">
                            <i class="bi bi-gear"></i> Settings
                        </a>
                    </li>
                </ul>
            </div>
        </div>
    </nav>

    <!-- Breadcrumb (optional) -->
    {% block breadcrumb %}{% endblock %}

    <!-- Main Content -->
    <main class="{% block main_class %}{% endblock %}">
        <!-- Toast Container for notifications -->
        <div class="toast-container position-fixed top-0 end-0 p-3" style="z-index: 1080;">
            <div id="liveToast" class="toast" role="alert" aria-live="assertive" aria-atomic="true">
                <div class="toast-header">
                    <i class="bi bi-info-circle-fill text-primary me-2"></i>
                    <strong class="me-auto">Notification</strong>
                    <small>just now</small>
                    <button type="button" class="btn-close" data-bs-dismiss="toast"></button>
                </div>
                <div class="toast-body">
                    <!-- Dynamic content -->
                </div>
            </div>
        </div>

        {% block content %}{% endblock %}
    </main>

    <!-- Footer -->
    <footer class="bg-light mt-5 py-4">
        <div class="container">
            <div class="row">
                <div class="col-md-4">
                    <h5 class="mb-3">KidsKlassiks</h5>
                    <p class="text-muted small">
                        Transform classic literature into magical children's stories with AI.
                    </p>
                </div>
                <div class="col-md-4">
                    <h6 class="mb-3">Quick Links</h6>
                    <ul class="list-unstyled">
                        <li><a href="/books/import" class="text-muted text-decoration-none">Import Book</a></li>
                        <li><a href="/adaptations/create" class="text-muted text-decoration-none">New Adaptation</a></li>
                        <li><a href="/settings" class="text-muted text-decoration-none">Settings</a></li>
                        <li><a href="/help" class="text-muted text-decoration-none">Help</a></li>
                    </ul>
                </div>
                <div class="col-md-4">
                    <h6 class="mb-3">AI Services Status</h6>
                    <div class="d-flex align-items-center mb-2">
                        <i class="bi bi-circle-fill text-{{ 'success' if openai_status else 'danger' }} me-2 small"></i>
                        <span class="text-muted small">OpenAI API</span>
                    </div>
                    <div class="d-flex align-items-center mb-2">
                        <i class="bi bi-circle-fill text-{{ 'success' if vertex_status else 'danger' }} me-2 small"></i>
                        <span class="text-muted small">Google Vertex AI</span>
                    </div>
                    <div class="d-flex align-items-center">
                        <i class="bi bi-circle-fill text-success me-2 small"></i>
                        <span class="text-muted small">Database Connected</span>
                    </div>
                </div>
            </div>
            <hr>
            <div class="text-center text-muted small">
                <div class="mb-2">
                    Â© <span id="copyright-year"></span> <a href="https://digitalgods.ai" target="_blank" class="text-decoration-none text-muted">DigitalGods.ai</a>. All Rights Reserved.
                </div>
                <div>
                    <a href="#" class="text-muted text-decoration-none me-3" data-bs-toggle="modal" data-bs-target="#termsModal">
                        <i class="bi bi-file-text"></i> Terms of Service
                    </a>
                    <a href="#" class="text-muted text-decoration-none me-3" data-bs-toggle="modal" data-bs-target="#privacyModal">
                        <i class="bi bi-shield-check"></i> Privacy Policy
                    </a>
                    <span class="text-muted">Powered by FastAPI + HTMX</span>
                </div>
            </div>
        </div>
    </footer>

    <!-- Terms of Service Modal -->
    <div class="modal fade" id="termsModal" tabindex="-1" aria-labelledby="termsModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-lg modal-dialog-scrollable">
            <div class="modal-content">
                <div class="modal-header bg-primary text-white">
                    <h5 class="modal-title" id="termsModalLabel">
                        <i class="bi bi-file-text"></i> Terms of Service
                    </h5>
                    <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <div class="p-3">
                        <h6 class="fw-bold mb-3">KidsKlassiks Terms of Service</h6>
                        <p class="text-muted small">Last Updated: <span id="terms-date"></span></p>
                        
                        <h6 class="mt-4 mb-2">1. Acceptance of Terms</h6>
                        <p>By accessing and using KidsKlassiks (the "Service"), you accept and agree to be bound by the terms and conditions of this agreement. The Service is owned and operated by DigitalGods.ai ("we", "us", or "our"). If you do not agree to these terms, please do not use the Service.</p>
                        
                        <h6 class="mt-4 mb-2">2. Description of Service</h6>
                        <p>KidsKlassiks is an AI-powered platform that transforms classic literature into age-appropriate children's stories. The Service uses artificial intelligence to adapt public domain books and generate illustrations.</p>
                        
                        <h6 class="mt-4 mb-2">3. User Obligations and Lawful Use</h6>
                        <p>You agree to use the Service only for lawful purposes and in compliance with all applicable laws and regulations. You specifically agree to:</p>
                        <ul>
                            <li>Not use the Service to create, distribute, or publish content that infringes upon intellectual property rights, including copyrights, trademarks, or patents</li>
                            <li>Only adapt and transform works that are in the public domain or for which you have explicit permission</li>
                            <li>Comply with all copyright laws, including proper attribution and fair use principles</li>
                            <li>Not use the Service to create content that is defamatory, obscene, threatening, harassing, or otherwise illegal</li>
                            <li>Not attempt to circumvent, disable, or interfere with security features of the Service</li>
                            <li>Not use automated systems to access the Service without express written permission</li>
                        </ul>
                        
                        <h6 class="mt-4 mb-2">4. Copyright and Intellectual Property</h6>
                        <p>You acknowledge and agree that:</p>
                        <ul>
                            <li>You are solely responsible for ensuring that any source material you upload to the Service is either in the public domain or properly licensed</li>
                            <li>You are solely responsible for any copyright infringement that may result from your use of the Service</li>
                            <li>DigitalGods.ai makes no representations or warranties regarding the copyright status of any materials</li>
                            <li>Content generated by the Service, including AI-generated text and images, may have complex ownership rights, and you are responsible for understanding and complying with applicable AI-generated content laws</li>
                        </ul>
                        
                        <h6 class="mt-4 mb-2">5. Disclaimer of Warranties</h6>
                        <p class="fw-bold">THE SERVICE IS PROVIDED "AS IS" AND "AS AVAILABLE" WITHOUT WARRANTIES OF ANY KIND, EITHER EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO:</p>
                        <ul>
                            <li>Warranties of merchantability, fitness for a particular purpose, or non-infringement</li>
                            <li>Any warranty that the Service will be uninterrupted, timely, secure, or error-free</li>
                            <li>Any warranty regarding the accuracy, reliability, or quality of content generated by the Service</li>
                            <li>Any warranty that defects will be corrected or that the Service is free from viruses or harmful components</li>
                        </ul>
                        
                        <h6 class="mt-4 mb-2">6. Limitation of Liability</h6>
                        <p class="fw-bold">TO THE MAXIMUM EXTENT PERMITTED BY LAW, DIGITALGODS.AI AND ITS OFFICERS, DIRECTORS, EMPLOYEES, AND AGENTS SHALL NOT BE LIABLE FOR:</p>
                        <ul>
                            <li>Any indirect, incidental, special, consequential, or punitive damages</li>
                            <li>Any loss of profits, revenue, data, or use</li>
                            <li>Any damages arising from your use of or inability to use the Service</li>
                            <li>Any damages arising from copyright infringement claims by third parties</li>
                            <li>Any damages arising from content generated, adapted, or published using the Service</li>
                            <li>Any damages arising from unauthorized access to or alteration of your data</li>
                        </ul>
                        <p>IN NO EVENT SHALL DIGITALGODS.AI'S TOTAL LIABILITY TO YOU FOR ALL DAMAGES EXCEED THE AMOUNT PAID BY YOU, IF ANY, FOR ACCESSING THE SERVICE IN THE TWELVE (12) MONTHS PRECEDING THE CLAIM.</p>
                        
                        <h6 class="mt-4 mb-2">7. Indemnification</h6>
                        <p>You agree to indemnify, defend, and hold harmless DigitalGods.ai, its officers, directors, employees, agents, licensors, and suppliers from and against all losses, expenses, damages, costs, claims, and demands, including reasonable attorneys' fees, resulting from:</p>
                        <ul>
                            <li>Your violation of these Terms of Service</li>
                            <li>Your violation of any law or the rights of a third party</li>
                            <li>Your use of the Service, including any content you create, adapt, or publish</li>
                            <li>Any copyright or intellectual property infringement arising from your use of the Service</li>
                        </ul>
                        
                        <h6 class="mt-4 mb-2">8. AI-Generated Content Notice</h6>
                        <p>You acknowledge that content generated by this Service is created using artificial intelligence and may contain errors, inaccuracies, or inappropriate content. You are solely responsible for reviewing, editing, and validating all AI-generated content before publication or distribution.</p>
                        
                        <h6 class="mt-4 mb-2">9. Termination</h6>
                        <p>We reserve the right to terminate or suspend your access to the Service immediately, without prior notice or liability, for any reason, including but not limited to breach of these Terms.</p>
                        
                        <h6 class="mt-4 mb-2">10. Governing Law</h6>
                        <p>These Terms shall be governed by and construed in accordance with the laws of the jurisdiction in which DigitalGods.ai operates, without regard to its conflict of law provisions.</p>
                        
                        <h6 class="mt-4 mb-2">11. Changes to Terms</h6>
                        <p>We reserve the right to modify these Terms at any time. Continued use of the Service after changes constitutes acceptance of the modified Terms.</p>
                        
                        <h6 class="mt-4 mb-2">12. Contact Information</h6>
                        <p>For questions about these Terms, please contact DigitalGods.ai through our official website.</p>
                        
                        <div class="alert alert-warning mt-4">
                            <i class="bi bi-exclamation-triangle"></i>
                            <strong>Important:</strong> By using this Service, you acknowledge that you have read, understood, and agree to be bound by these Terms of Service.
                        </div>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Privacy Policy Modal -->
    <div class="modal fade" id="privacyModal" tabindex="-1" aria-labelledby="privacyModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-lg modal-dialog-scrollable">
            <div class="modal-content">
                <div class="modal-header bg-primary text-white">
                    <h5 class="modal-title" id="privacyModalLabel">
                        <i class="bi bi-shield-check"></i> Privacy Policy
                    </h5>
                    <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <div class="p-3">
                        <h6 class="fw-bold mb-3">KidsKlassiks Privacy Policy</h6>
                        <p class="text-muted small">Last Updated: <span id="privacy-date"></span></p>
                        
                        <h6 class="mt-4 mb-2">1. Information We Collect</h6>
                        <p>KidsKlassiks collects the following information:</p>
                        <ul>
                            <li>Books and text content you upload for adaptation</li>
                            <li>Adaptations, chapters, and generated content you create</li>
                            <li>Usage data and technical information about how you use the Service</li>
                        </ul>
                        
                        <h6 class="mt-4 mb-2">2. How We Use Your Information</h6>
                        <p>We use your information to:</p>
                        <ul>
                            <li>Provide and improve the Service</li>
                            <li>Generate AI-powered adaptations and illustrations</li>
                            <li>Maintain and troubleshoot the Service</li>
                        </ul>
                        
                        <h6 class="mt-4 mb-2">3. Third-Party Services</h6>
                        <p>We use third-party AI services (OpenAI, Google Vertex AI) to generate content. Your data may be processed by these services in accordance with their privacy policies.</p>
                        
                        <h6 class="mt-4 mb-2">4. Data Security</h6>
                        <p>We implement reasonable security measures to protect your data, but cannot guarantee absolute security.</p>
                        
                        <h6 class="mt-4 mb-2">5. Your Rights</h6>
                        <p>You have the right to access, modify, or delete your data at any time through the Service.</p>
                        
                        <h6 class="mt-4 mb-2">6. Contact Us</h6>
                        <p>For privacy concerns, please contact DigitalGods.ai through our official website.</p>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn-secondary" data-bs-dismiss="modal">Close</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Bootstrap JS Bundle -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    
    <!-- Custom JS -->
    <script>
        // Set current year for copyright
        document.getElementById('copyright-year').textContent = new Date().getFullYear();
        
        // Set current date for terms and privacy
        const currentDate = new Date().toLocaleDateString('en-US', { 
            year: 'numeric', 
            month: 'long', 
            day: 'numeric' 
        });
        const termsDateEl = document.getElementById('terms-date');
        const privacyDateEl = document.getElementById('privacy-date');
        if (termsDateEl) termsDateEl.textContent = currentDate;
        if (privacyDateEl) privacyDateEl.textContent = currentDate;
        
        // HTMX event handlers
        document.body.addEventListener('htmx:afterRequest', function(event) {
            // Handle successful responses
            if (event.detail.successful) {
                // Check for success messages
                const response = event.detail.xhr.response;
                if (response.includes('success')) {
                    showToast('Success', 'Operation completed successfully', 'success');
                }
            }
        });

        // Toast notification function
        function showToast(title, message, type = 'info') {
            const toastEl = document.getElementById('liveToast');
            const toastHeader = toastEl.querySelector('.toast-header strong');
            const toastBody = toastEl.querySelector('.toast-body');
            const toastIcon = toastEl.querySelector('.toast-header i');
            
            // Update content
            toastHeader.textContent = title;
            toastBody.textContent = message;
            
            // Update icon based on type
            toastIcon.className = `bi me-2 ${
                type === 'success' ? 'bi-check-circle-fill text-success' :
                type === 'error' ? 'bi-x-circle-fill text-danger' :
                type === 'warning' ? 'bi-exclamation-triangle-fill text-warning' :
                'bi-info-circle-fill text-primary'
            }`;
            
            // Show toast
            const toast = new bootstrap.Toast(toastEl);
            toast.show();
        }

        // Initialize tooltips
        const tooltipTriggerList = document.querySelectorAll('[data-bs-toggle="tooltip"]');
        const tooltipList = [...tooltipTriggerList].map(tooltipTriggerEl => new bootstrap.Tooltip(tooltipTriggerEl));

        // Dark mode toggle (if needed)
        function toggleDarkMode() {
            document.body.classList.toggle('dark-mode');
            localStorage.setItem('darkMode', document.body.classList.contains('dark-mode'));
        }

        // Check for saved dark mode preference
        if (localStorage.getItem('darkMode') === 'true') {
            document.body.classList.add('dark-mode');
        }
    </script>
    
    {% block extra_js %}{% endblock %}
</body>
</html>
