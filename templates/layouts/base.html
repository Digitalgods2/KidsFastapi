<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{% block title %}KidsKlassiks AI Story Transformer{% endblock %}</title>
    
    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <!-- Bootstrap Icons -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.0/font/bootstrap-icons.css">
    <!-- Custom CSS -->
    <link href="/static/css/style.css" rel="stylesheet">
    
    <!-- Theme Styles -->
    <style>
        /* Theme Switcher Icon Styling */
        #themeToggle {
            cursor: pointer;
            transition: transform 0.3s ease;
        }
        
        #themeToggle:hover {
            transform: scale(1.1);
        }
        
        #themeIcon {
            font-size: 1.2rem;
            transition: all 0.3s ease;
        }
        
        /* System Theme (uses Bootstrap default or dark based on system preference) */
        .theme-system {
            /* No additional styles - uses Bootstrap's built-in theming */
        }
        
        /* Pure Dark Theme - True black background */
        .theme-dark {
            --bs-body-bg: #000000;
            --bs-body-color: #ffffff;
            --bs-card-bg: #111111;
            --bs-border-color: #333333;
            background-color: #000000 !important;
        }
        
        .theme-dark .card {
            background-color: #111111;
            border-color: #333333;
        }
        
        .theme-dark .navbar {
            background-color: #000000 !important;
            border-bottom: 1px solid #333333;
        }
        
        .theme-dark .modal-content {
            background-color: #111111;
            color: #ffffff;
        }
        
        .theme-dark .form-control,
        .theme-dark .form-select {
            background-color: #1a1a1a;
            border-color: #333333;
            color: #ffffff;
        }
        
        .theme-dark .form-control:focus,
        .theme-dark .form-select:focus {
            background-color: #1a1a1a;
            border-color: #555555;
            color: #ffffff;
        }
        
        .theme-dark .btn-outline-primary {
            color: #6ea8fe;
            border-color: #6ea8fe;
        }
        
        .theme-dark .btn-outline-primary:hover {
            background-color: #6ea8fe;
            color: #000000;
        }
        
        /* Charcoal Theme - Dark gray background */
        .theme-charcoal {
            --bs-body-bg: #1a1a1a;
            --bs-body-color: #e0e0e0;
            --bs-card-bg: #2a2a2a;
            --bs-border-color: #404040;
            background-color: #1a1a1a !important;
        }
        
        .theme-charcoal .card {
            background-color: #2a2a2a;
            border-color: #404040;
        }
        
        .theme-charcoal .navbar {
            background-color: #0d0d0d !important;
            border-bottom: 1px solid #404040;
        }
        
        .theme-charcoal .modal-content {
            background-color: #2a2a2a;
            color: #e0e0e0;
        }
        
        .theme-charcoal .form-control,
        .theme-charcoal .form-select {
            background-color: #353535;
            border-color: #404040;
            color: #e0e0e0;
        }
        
        .theme-charcoal .form-control:focus,
        .theme-charcoal .form-select:focus {
            background-color: #353535;
            border-color: #555555;
            color: #e0e0e0;
        }
        
        .theme-charcoal .btn-outline-primary {
            color: #8ab4f8;
            border-color: #8ab4f8;
        }
        
        .theme-charcoal .btn-outline-primary:hover {
            background-color: #8ab4f8;
            color: #1a1a1a;
        }
        
        .theme-charcoal .text-muted {
            color: #999999 !important;
        }
        
        /* Common dark theme adjustments */
        .theme-dark .dropdown-menu,
        .theme-charcoal .dropdown-menu {
            background-color: var(--bs-card-bg);
            border-color: var(--bs-border-color);
        }
        
        .theme-dark .dropdown-item,
        .theme-charcoal .dropdown-item {
            color: var(--bs-body-color);
        }
        
        .theme-dark .dropdown-item:hover,
        .theme-charcoal .dropdown-item:hover {
            background-color: rgba(255, 255, 255, 0.1);
        }
        
        .theme-dark .table,
        .theme-charcoal .table {
            --bs-table-bg: transparent;
            --bs-table-striped-bg: rgba(255, 255, 255, 0.05);
            --bs-table-hover-bg: rgba(255, 255, 255, 0.075);
            color: var(--bs-body-color);
        }
        
        .theme-dark .alert-info,
        .theme-charcoal .alert-info {
            background-color: rgba(13, 110, 253, 0.2);
            border-color: rgba(13, 110, 253, 0.3);
            color: #8ab4f8;
        }
    </style>
    
    <!-- HTMX -->
    <script src="https://unpkg.com/htmx.org@1.9.10"></script>
    <!-- Alpine.js for reactive components -->
    <script defer src="https://unpkg.com/alpinejs@3.x.x/dist/cdn.min.js"></script>
    
    {% block extra_css %}{% endblock %}
</head>
<body>
    <!-- Navigation -->
    <nav class="navbar navbar-expand-lg navbar-dark bg-primary shadow-sm">
        <div class="container-fluid">
            <a class="navbar-brand d-flex align-items-center" href="/">
                <i class="bi bi-book-half fs-4 me-2"></i>
                <span class="fw-bold">KidsKlassiks</span>
            </a>
            
            <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav">
                <span class="navbar-toggler-icon"></span>
            </button>
            
            <div class="collapse navbar-collapse" id="navbarNav">
                <ul class="navbar-nav me-auto">
                    <li class="nav-item">
                        <a class="nav-link {% if request.url.path == '/' %}active{% endif %}" href="/">
                            <i class="bi bi-house"></i> Home
                        </a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link {% if request.url.path == '/dashboard' %}active{% endif %}" href="/dashboard">
                            <i class="bi bi-speedometer2"></i> Dashboard
                        </a>
                    </li>
                    <li class="nav-item dropdown">
                        <a class="nav-link dropdown-toggle {% if 'books' in request.url.path %}active{% endif %}" href="#" role="button" data-bs-toggle="dropdown">
                            <i class="bi bi-book"></i> Books
                        </a>
                        <ul class="dropdown-menu">
                            <li><a class="dropdown-item" href="/books/import">
                                <i class="bi bi-upload"></i> Import New Book
                            </a></li>
                            <li><a class="dropdown-item" href="/books/library">
                                <i class="bi bi-collection"></i> Browse Library
                            </a></li>
                            <li><hr class="dropdown-divider"></li>
                            <li><a class="dropdown-item" href="/books/gutenberg">
                                <i class="bi bi-globe"></i> Project Gutenberg
                            </a></li>
                        </ul>
                    </li>
                    <li class="nav-item dropdown">
                        <a class="nav-link dropdown-toggle {% if 'adaptations' in request.url.path %}active{% endif %}" href="#" role="button" data-bs-toggle="dropdown">
                            <i class="bi bi-layers"></i> Adaptations
                        </a>
                        <ul class="dropdown-menu">
                            <li><a class="dropdown-item" href="/adaptations/create">
                                <i class="bi bi-plus-circle"></i> New Adaptation
                            </a></li>
                            <li><a class="dropdown-item" href="/adaptations">
                                <i class="bi bi-list"></i> View All
                            </a></li>
                            <li><hr class="dropdown-divider"></li>
                            <li><a class="dropdown-item" href="/adaptations/in-progress">
                                <i class="bi bi-hourglass-split"></i> In Progress
                            </a></li>
                            <li><a class="dropdown-item" href="/adaptations/completed">
                                <i class="bi bi-check-circle"></i> Completed
                            </a></li>
                        </ul>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link {% if request.url.path == '/publish' %}active{% endif %}" href="/publish">
                            <i class="bi bi-file-earmark-pdf"></i> Publish
                        </a>
                    </li>
                </ul>
                
                <ul class="navbar-nav">
                    <!-- Notifications -->
                    <li class="nav-item dropdown me-3">
                        <a class="nav-link position-relative" href="#" role="button" data-bs-toggle="dropdown">
                            <i class="bi bi-bell"></i>
                            {% if notifications_count > 0 %}
                            <span class="position-absolute top-0 start-100 translate-middle badge rounded-pill bg-danger">
                                {{ notifications_count }}
                            </span>
                            {% endif %}
                        </a>
                        <ul class="dropdown-menu dropdown-menu-end">
                            <li><h6 class="dropdown-header">Notifications</h6></li>
                            {% if notifications %}
                                {% for notification in notifications %}
                                <li>
                                    <a class="dropdown-item" href="{{ notification.link }}">
                                        <small class="text-muted">{{ notification.time }}</small><br>
                                        {{ notification.message }}
                                    </a>
                                </li>
                                {% endfor %}
                            {% else %}
                                <li><span class="dropdown-item-text text-muted">No new notifications</span></li>
                            {% endif %}
                        </ul>
                    </li>
                    
                    <!-- Help -->
                    <li class="nav-item">
                        <a class="nav-link" href="#" data-bs-toggle="modal" data-bs-target="#helpModal">
                            <i class="bi bi-question-circle"></i> Help
                        </a>
                    </li>
                    
                    <!-- Theme Switcher -->
                    <li class="nav-item">
                        <a class="nav-link" href="#" id="themeToggle" title="Change theme">
                            <i class="bi bi-moon-stars-fill" id="themeIcon"></i>
                        </a>
                    </li>
                    
                    <!-- Settings -->
                    <li class="nav-item">
                        <a class="nav-link {% if request.url.path == '/settings' %}active{% endif %}" href="/settings">
                            <i class="bi bi-gear"></i> Settings
                        </a>
                    </li>
                </ul>
            </div>
        </div>
    </nav>

    <!-- Breadcrumb (optional) -->
    {% block breadcrumb %}{% endblock %}

    <!-- Main Content -->
    <main class="{% block main_class %}{% endblock %}">
        <!-- Toast Container for notifications -->
        <div class="toast-container position-fixed top-0 end-0 p-3" style="z-index: 1080;">
            <div id="liveToast" class="toast" role="alert" aria-live="assertive" aria-atomic="true">
                <div class="toast-header">
                    <i class="bi bi-info-circle-fill text-primary me-2"></i>
                    <strong class="me-auto">Notification</strong>
                    <small>just now</small>
                    <button type="button" class="btn-close" data-bs-dismiss="toast"></button>
                </div>
                <div class="toast-body">
                    <!-- Dynamic content -->
                </div>
            </div>
        </div>

        {% block content %}{% endblock %}
    </main>

    <!-- Footer -->
    <footer class="bg-light mt-5 py-4">
        <div class="container">
            <div class="row">
                <div class="col-md-4">
                    <h5 class="mb-3">KidsKlassiks</h5>
                    <p class="text-muted small">
                        Transform classic literature into magical children's stories with AI.
                    </p>
                </div>
                <div class="col-md-4">
                    <h6 class="mb-3">Quick Links</h6>
                    <ul class="list-unstyled">
                        <li><a href="/books/import" class="text-muted text-decoration-none">Import Book</a></li>
                        <li><a href="/adaptations/create" class="text-muted text-decoration-none">New Adaptation</a></li>
                        <li><a href="/settings" class="text-muted text-decoration-none">Settings</a></li>
                        <li><a href="/help" class="text-muted text-decoration-none">Help</a></li>
                    </ul>
                </div>
                <div class="col-md-4">
                    <h6 class="mb-3">AI Services Status</h6>
                    <div class="d-flex align-items-center mb-2">
                        <i class="bi bi-circle-fill text-{{ 'success' if openai_status else 'danger' }} me-2 small"></i>
                        <span class="text-muted small">OpenAI API</span>
                    </div>
                    <div class="d-flex align-items-center mb-2">
                        <i class="bi bi-circle-fill text-{{ 'success' if vertex_status else 'danger' }} me-2 small"></i>
                        <span class="text-muted small">Google Vertex AI</span>
                    </div>
                    <div class="d-flex align-items-center">
                        <i class="bi bi-circle-fill text-success me-2 small"></i>
                        <span class="text-muted small">Database Connected</span>
                    </div>
                </div>
            </div>
            <hr>
            <div class="text-center small">
                <div class="mb-2 text-muted">
                    © <span id="copyright-year"></span> <a href="https://digitalgods.ai" target="_blank" class="text-decoration-none text-primary fw-semibold">DigitalGods.ai</a>. All Rights Reserved.
                </div>
                <div>
                    <a href="#" class="text-primary text-decoration-none me-3 fw-semibold" data-bs-toggle="modal" data-bs-target="#termsModal">
                        <i class="bi bi-file-text"></i> Terms of Service
                    </a>
                    <a href="#" class="text-primary text-decoration-none me-3 fw-semibold" data-bs-toggle="modal" data-bs-target="#privacyModal">
                        <i class="bi bi-shield-check"></i> Privacy Policy
                    </a>
                </div>
            </div>
        </div>
    </footer>

    <!-- Terms of Service Modal -->
    <div class="modal fade" id="termsModal" tabindex="-1" aria-labelledby="termsModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-lg modal-dialog-scrollable">
            <div class="modal-content">
                <div class="modal-header bg-primary text-white">
                    <h5 class="modal-title" id="termsModalLabel">
                        <i class="bi bi-file-text"></i> Terms of Service
                    </h5>
                    <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <div class="p-3">
                        <h6 class="fw-bold mb-3">KidsKlassiks Terms of Service</h6>
                        <p class="text-muted small">Last Updated: <span id="terms-date"></span></p>
                        
                        <h6 class="mt-4 mb-2">1. Acceptance of Terms</h6>
                        <p>By accessing and using KidsKlassiks (the "Service"), you accept and agree to be bound by the terms and conditions of this agreement. The Service is owned and operated by DigitalGods.ai ("we", "us", or "our"). If you do not agree to these terms, please do not use the Service.</p>
                        
                        <h6 class="mt-4 mb-2">2. Description of Service</h6>
                        <p>KidsKlassiks is an AI-powered platform that transforms classic literature into age-appropriate children's stories. The Service uses artificial intelligence to adapt public domain books and generate illustrations.</p>
                        
                        <h6 class="mt-4 mb-2">3. User Obligations and Lawful Use</h6>
                        <p>You agree to use the Service only for lawful purposes and in compliance with all applicable laws and regulations. You specifically agree to:</p>
                        <ul>
                            <li>Not use the Service to create, distribute, or publish content that infringes upon intellectual property rights, including copyrights, trademarks, or patents</li>
                            <li>Only adapt and transform works that are in the public domain or for which you have explicit permission</li>
                            <li>Comply with all copyright laws, including proper attribution and fair use principles</li>
                            <li>Not use the Service to create content that is defamatory, obscene, threatening, harassing, or otherwise illegal</li>
                            <li>Not attempt to circumvent, disable, or interfere with security features of the Service</li>
                            <li>Not use automated systems to access the Service without express written permission</li>
                        </ul>
                        
                        <h6 class="mt-4 mb-2">4. Copyright and Intellectual Property</h6>
                        <p>You acknowledge and agree that:</p>
                        <ul>
                            <li>You are solely responsible for ensuring that any source material you upload to the Service is either in the public domain or properly licensed</li>
                            <li>You are solely responsible for any copyright infringement that may result from your use of the Service</li>
                            <li>DigitalGods.ai makes no representations or warranties regarding the copyright status of any materials</li>
                            <li>Content generated by the Service, including AI-generated text and images, may have complex ownership rights, and you are responsible for understanding and complying with applicable AI-generated content laws</li>
                        </ul>
                        
                        <h6 class="mt-4 mb-2">5. Disclaimer of Warranties</h6>
                        <p class="fw-bold">THE SERVICE IS PROVIDED "AS IS" AND "AS AVAILABLE" WITHOUT WARRANTIES OF ANY KIND, EITHER EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO:</p>
                        <ul>
                            <li>Warranties of merchantability, fitness for a particular purpose, or non-infringement</li>
                            <li>Any warranty that the Service will be uninterrupted, timely, secure, or error-free</li>
                            <li>Any warranty regarding the accuracy, reliability, or quality of content generated by the Service</li>
                            <li>Any warranty that defects will be corrected or that the Service is free from viruses or harmful components</li>
                        </ul>
                        
                        <h6 class="mt-4 mb-2">6. Limitation of Liability</h6>
                        <p class="fw-bold">TO THE MAXIMUM EXTENT PERMITTED BY LAW, DIGITALGODS.AI AND ITS OFFICERS, DIRECTORS, EMPLOYEES, AND AGENTS SHALL NOT BE LIABLE FOR:</p>
                        <ul>
                            <li>Any indirect, incidental, special, consequential, or punitive damages</li>
                            <li>Any loss of profits, revenue, data, or use</li>
                            <li>Any damages arising from your use of or inability to use the Service</li>
                            <li>Any damages arising from copyright infringement claims by third parties</li>
                            <li>Any damages arising from content generated, adapted, or published using the Service</li>
                            <li>Any damages arising from unauthorized access to or alteration of your data</li>
                        </ul>
                        <p>IN NO EVENT SHALL DIGITALGODS.AI'S TOTAL LIABILITY TO YOU FOR ALL DAMAGES EXCEED THE AMOUNT PAID BY YOU, IF ANY, FOR ACCESSING THE SERVICE IN THE TWELVE (12) MONTHS PRECEDING THE CLAIM.</p>
                        
                        <h6 class="mt-4 mb-2">7. Indemnification</h6>
                        <p>You agree to indemnify, defend, and hold harmless DigitalGods.ai, its officers, directors, employees, agents, licensors, and suppliers from and against all losses, expenses, damages, costs, claims, and demands, including reasonable attorneys' fees, resulting from:</p>
                        <ul>
                            <li>Your violation of these Terms of Service</li>
                            <li>Your violation of any law or the rights of a third party</li>
                            <li>Your use of the Service, including any content you create, adapt, or publish</li>
                            <li>Any copyright or intellectual property infringement arising from your use of the Service</li>
                        </ul>
                        
                        <h6 class="mt-4 mb-2">8. AI-Generated Content Notice</h6>
                        <p>You acknowledge that content generated by this Service is created using artificial intelligence and may contain errors, inaccuracies, or inappropriate content. You are solely responsible for reviewing, editing, and validating all AI-generated content before publication or distribution.</p>
                        
                        <h6 class="mt-4 mb-2">9. Termination</h6>
                        <p>We reserve the right to terminate or suspend your access to the Service immediately, without prior notice or liability, for any reason, including but not limited to breach of these Terms.</p>
                        
                        <h6 class="mt-4 mb-2">10. Governing Law</h6>
                        <p>These Terms shall be governed by and construed in accordance with the laws of the jurisdiction in which DigitalGods.ai operates, without regard to its conflict of law provisions.</p>
                        
                        <h6 class="mt-4 mb-2">11. Changes to Terms</h6>
                        <p>We reserve the right to modify these Terms at any time. Continued use of the Service after changes constitutes acceptance of the modified Terms.</p>
                        
                        <h6 class="mt-4 mb-2">12. Contact Information</h6>
                        <p>For questions about these Terms, please contact DigitalGods.ai through our official website.</p>
                        
                        <div class="alert alert-warning mt-4">
                            <i class="bi bi-exclamation-triangle"></i>
                            <strong>Important:</strong> By using this Service, you acknowledge that you have read, understood, and agree to be bound by these Terms of Service.
                        </div>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Privacy Policy Modal -->
    <div class="modal fade" id="privacyModal" tabindex="-1" aria-labelledby="privacyModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-lg modal-dialog-scrollable">
            <div class="modal-content">
                <div class="modal-header bg-primary text-white">
                    <h5 class="modal-title" id="privacyModalLabel">
                        <i class="bi bi-shield-check"></i> Privacy Policy
                    </h5>
                    <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <div class="p-3">
                        <h6 class="fw-bold mb-3">KidsKlassiks Privacy Policy</h6>
                        <p class="text-muted small">Last Updated: <span id="privacy-date"></span></p>
                        
                        <h6 class="mt-4 mb-2">1. Information We Collect</h6>
                        <p>KidsKlassiks collects the following information:</p>
                        <ul>
                            <li>Books and text content you upload for adaptation</li>
                            <li>Adaptations, chapters, and generated content you create</li>
                            <li>Usage data and technical information about how you use the Service</li>
                        </ul>
                        
                        <h6 class="mt-4 mb-2">2. How We Use Your Information</h6>
                        <p>We use your information to:</p>
                        <ul>
                            <li>Provide and improve the Service</li>
                            <li>Generate AI-powered adaptations and illustrations</li>
                            <li>Maintain and troubleshoot the Service</li>
                        </ul>
                        
                        <h6 class="mt-4 mb-2">3. Third-Party Services</h6>
                        <p>We use third-party AI services (OpenAI, Google Vertex AI) to generate content. Your data may be processed by these services in accordance with their privacy policies.</p>
                        
                        <h6 class="mt-4 mb-2">4. Data Security</h6>
                        <p>We implement reasonable security measures to protect your data, but cannot guarantee absolute security.</p>
                        
                        <h6 class="mt-4 mb-2">5. Your Rights</h6>
                        <p>You have the right to access, modify, or delete your data at any time through the Service.</p>
                        
                        <h6 class="mt-4 mb-2">6. Contact Us</h6>
                        <p>For privacy concerns, please contact DigitalGods.ai through our official website.</p>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn-secondary" data-bs-dismiss="modal">Close</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Help Modal -->
    <div class="modal fade" id="helpModal" tabindex="-1" aria-labelledby="helpModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-xl modal-dialog-scrollable">
            <div class="modal-content">
                <div class="modal-header bg-primary text-white">
                    <h5 class="modal-title" id="helpModalLabel">
                        <i class="bi bi-question-circle"></i> KidsKlassiks User Guide
                    </h5>
                    <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <div class="p-3">
                        <div class="alert alert-info">
                            <i class="bi bi-info-circle"></i>
                            <strong>Welcome to KidsKlassiks!</strong> This comprehensive guide will help you transform classic literature into engaging children's stories using AI.
                        </div>

                        <nav class="nav nav-pills flex-column flex-sm-row mb-4">
                            <a class="flex-sm-fill text-sm-center nav-link active" data-bs-toggle="tab" href="#help-overview">Overview</a>
                            <a class="flex-sm-fill text-sm-center nav-link" data-bs-toggle="tab" href="#help-books">Books</a>
                            <a class="flex-sm-fill text-sm-center nav-link" data-bs-toggle="tab" href="#help-adaptations">Adaptations</a>
                            <a class="flex-sm-fill text-sm-center nav-link" data-bs-toggle="tab" href="#help-images">Images</a>
                            <a class="flex-sm-fill text-sm-center nav-link" data-bs-toggle="tab" href="#help-publish">Publishing</a>
                            <a class="flex-sm-fill text-sm-center nav-link" data-bs-toggle="tab" href="#help-tips">Tips & FAQ</a>
                        </nav>

                        <div class="tab-content">
                            <!-- Overview Tab -->
                            <div class="tab-pane fade show active" id="help-overview">
                                <h5 class="mb-3"><i class="bi bi-book"></i> What is KidsKlassiks?</h5>
                                <p>KidsKlassiks is an AI-powered platform that transforms classic literature into age-appropriate children's stories. Using advanced artificial intelligence, you can:</p>
                                <ul>
                                    <li>Import classic books from Project Gutenberg or upload your own</li>
                                    <li>Automatically adapt text for different age groups (3-5, 6-8, 9-12 years)</li>
                                    <li>Generate AI-powered illustrations for chapters and covers</li>
                                    <li>Preview and publish complete adapted books</li>
                                </ul>

                                <h6 class="mt-4 mb-2">Quick Start Workflow</h6>
                                <ol class="mb-3">
                                    <li><strong>Import a Book</strong> - Start with a classic from Project Gutenberg or upload your own</li>
                                    <li><strong>Create Adaptation</strong> - Choose age group, style, and transformation options</li>
                                    <li><strong>Generate Content</strong> - AI transforms the text into child-friendly chapters</li>
                                    <li><strong>Add Illustrations</strong> - Generate cover and chapter images using AI</li>
                                    <li><strong>Preview & Publish</strong> - Review your adaptation and export as PDF</li>
                                </ol>

                                <div class="alert alert-success">
                                    <i class="bi bi-lightbulb"></i>
                                    <strong>Pro Tip:</strong> Start with a well-known classic like "The Wonderful Wizard of Oz" to get familiar with the workflow.
                                </div>
                            </div>

                            <!-- Books Tab -->
                            <div class="tab-pane fade" id="help-books">
                                <h5 class="mb-3"><i class="bi bi-collection"></i> Managing Books</h5>
                                
                                <h6 class="mt-3 mb-2">Importing from Project Gutenberg</h6>
                                <ol>
                                    <li>Go to <strong>Books > Project Gutenberg</strong></li>
                                    <li>Search for a classic book by title or author</li>
                                    <li>Click <strong>"Import"</strong> on your chosen book</li>
                                    <li>The system downloads and processes the book automatically</li>
                                </ol>
                                <p class="text-muted small"><i class="bi bi-info-circle"></i> Project Gutenberg offers over 70,000 free public domain books.</p>

                                <h6 class="mt-4 mb-2">Uploading Your Own Books</h6>
                                <ol>
                                    <li>Go to <strong>Books > Import New Book</strong></li>
                                    <li>Enter book title and author</li>
                                    <li>Upload a text file (.txt) or paste content directly</li>
                                    <li>Click <strong>"Import Book"</strong> to add to your library</li>
                                </ol>
                                <div class="alert alert-warning">
                                    <i class="bi bi-exclamation-triangle"></i>
                                    <strong>Copyright Notice:</strong> Only upload books that are in the public domain or for which you have permission. You are responsible for copyright compliance.
                                </div>

                                <h6 class="mt-4 mb-2">Browsing Your Library</h6>
                                <p>Access <strong>Books > Browse Library</strong> to:</p>
                                <ul>
                                    <li>View all imported books</li>
                                    <li>See book details (title, author, word count, chapter count)</li>
                                    <li>Create new adaptations from existing books</li>
                                    <li>Delete books you no longer need</li>
                                </ul>
                            </div>

                            <!-- Adaptations Tab -->
                            <div class="tab-pane fade" id="help-adaptations">
                                <h5 class="mb-3"><i class="bi bi-layers"></i> Creating Adaptations</h5>
                                
                                <h6 class="mt-3 mb-2">Step 1: Start New Adaptation</h6>
                                <ol>
                                    <li>Go to <strong>Adaptations > New Adaptation</strong></li>
                                    <li>Select a book from your library</li>
                                    <li>Configure adaptation settings</li>
                                </ol>

                                <h6 class="mt-4 mb-2">Configuration Options</h6>
                                <ul>
                                    <li><strong>Target Age Group:</strong>
                                        <ul>
                                            <li><em>3-5 years:</em> Very simple vocabulary, short sentences, repetitive patterns</li>
                                            <li><em>6-8 years:</em> Simple vocabulary, moderate sentence length, clear storylines</li>
                                            <li><em>9-12 years:</em> Advanced vocabulary, complex sentences, detailed narratives</li>
                                        </ul>
                                    </li>
                                    <li><strong>Transformation Style:</strong> Fairy Tale, Adventure, Educational, Whimsical, etc.</li>
                                    <li><strong>Theme/Tone:</strong> Happy, Adventurous, Magical, Exciting, etc.</li>
                                    <li><strong>Key Characters:</strong> Which characters to preserve from the original</li>
                                </ul>

                                <h6 class="mt-4 mb-2">Step 2: Process Chapters</h6>
                                <ol>
                                    <li>After configuration, click <strong>"Process Chapters"</strong></li>
                                    <li>AI analyzes the book and creates chapter breakdowns</li>
                                    <li>Text is transformed to match the target age group</li>
                                    <li>Wait for processing to complete (usually 1-5 minutes)</li>
                                </ol>

                                <h6 class="mt-4 mb-2">Step 3: Review & Edit</h6>
                                <p>Once processing completes:</p>
                                <ul>
                                    <li>View all adapted chapters</li>
                                    <li>Read through transformed text</li>
                                    <li>Edit any chapter text directly in the interface</li>
                                    <li>Proceed to image generation when satisfied</li>
                                </ul>

                                <div class="alert alert-info">
                                    <i class="bi bi-clock"></i>
                                    <strong>Processing Time:</strong> Chapter processing typically takes 1-5 minutes depending on book length and complexity.
                                </div>
                            </div>

                            <!-- Images Tab -->
                            <div class="tab-pane fade" id="help-images">
                                <h5 class="mb-3"><i class="bi bi-image"></i> Generating Illustrations</h5>
                                
                                <h6 class="mt-3 mb-2">Cover Images</h6>
                                <ol>
                                    <li>Navigate to your adaptation's image page</li>
                                    <li>In the <strong>Cover Image</strong> section:</li>
                                    <li>Click <strong>"Generate Prompt"</strong> - AI creates a detailed image description</li>
                                    <li>Review and edit the prompt if desired</li>
                                    <li>Click <strong>"Save Prompt"</strong> to save without generating (optional)</li>
                                    <li>Click <strong>"Generate Image"</strong> to create the cover</li>
                                    <li>Wait 10-15 seconds for AI image generation</li>
                                </ol>

                                <h6 class="mt-4 mb-2">Chapter Images</h6>
                                <ol>
                                    <li>Scroll to the <strong>Chapter Images</strong> section</li>
                                    <li>For each chapter:
                                        <ul>
                                            <li>Click <strong>"Generate Prompt"</strong> to create image description</li>
                                            <li>Edit the prompt to match your vision</li>
                                            <li>Click <strong>"Generate Image"</strong> to create illustration</li>
                                        </ul>
                                    </li>
                                    <li>Images appear immediately after generation</li>
                                    <li>Regenerate any image if you're not satisfied</li>
                                </ol>

                                <h6 class="mt-4 mb-2">AI Backend Options</h6>
                                <p>Configure in <strong>Settings</strong>:</p>
                                <ul>
                                    <li><strong>DALL-E 3 (OpenAI):</strong> High quality, consistent style, good text rendering</li>
                                    <li><strong>Vertex AI Imagen 4 (Google):</strong> Exceptional quality, photorealistic, superior text rendering</li>
                                </ul>

                                <h6 class="mt-4 mb-2">Image Settings</h6>
                                <p>In <strong>Settings</strong>, configure:</p>
                                <ul>
                                    <li><strong>Default Backend:</strong> Choose your preferred AI service</li>
                                    <li><strong>Image Size:</strong> Select aspect ratio (1024x1024, 1792x1024, etc.)</li>
                                    <li><strong>API Keys:</strong> Configure your OpenAI or Google Cloud credentials</li>
                                </ul>

                                <div class="alert alert-success">
                                    <i class="bi bi-magic"></i>
                                    <strong>Best Practice:</strong> Generate the cover first, then chapter images. This ensures consistent style throughout your book.
                                </div>

                                <div class="alert alert-warning">
                                    <i class="bi bi-hourglass-split"></i>
                                    <strong>Generation Time:</strong> Each image takes 10-15 seconds. For a 25-chapter book, budget 5-10 minutes for all illustrations.
                                </div>
                            </div>

                            <!-- Publishing Tab -->
                            <div class="tab-pane fade" id="help-publish">
                                <h5 class="mb-3"><i class="bi bi-file-earmark-pdf"></i> Publishing Your Adaptation</h5>
                                
                                <h6 class="mt-3 mb-2">Publish Page Overview</h6>
                                <p>Go to <strong>Publish</strong> to see all your adaptations with:</p>
                                <ul>
                                    <li><strong>Cover thumbnails</strong> (if generated)</li>
                                    <li><strong>Content statistics:</strong> Chapter count, image count, word count</li>
                                    <li><strong>Completion percentage:</strong> Visual progress indicator</li>
                                    <li><strong>Status badges:</strong> Cover status, illustration percentage</li>
                                </ul>

                                <h6 class="mt-4 mb-2">Preview Your Book</h6>
                                <ol>
                                    <li>Click <strong>"Preview"</strong> on any adaptation</li>
                                    <li>View a beautiful book-style layout with:
                                        <ul>
                                            <li>Cover image and title page</li>
                                            <li>All chapters with images</li>
                                            <li>Complete formatted text</li>
                                        </ul>
                                    </li>
                                    <li>Use <strong>"Print"</strong> button for browser print</li>
                                    <li>Scroll through to review entire book</li>
                                </ol>

                                <h6 class="mt-4 mb-2">Export as PDF</h6>
                                <ol>
                                    <li>From the Publish page, click <strong>"Export PDF"</strong></li>
                                    <li>Or from Preview page, click <strong>"Export PDF"</strong></li>
                                    <li>PDF is generated with all content and images</li>
                                    <li>Download and share your adapted book!</li>
                                </ol>

                                <h6 class="mt-4 mb-2">Publishing Checklist</h6>
                                <div class="card bg-light">
                                    <div class="card-body">
                                        <p class="mb-2">Before publishing, ensure:</p>
                                        <ul class="mb-0">
                                            <li>✓ All chapters have been processed and reviewed</li>
                                            <li>✓ Cover image has been generated</li>
                                            <li>✓ Chapter images are complete (or as desired)</li>
                                            <li>✓ Text has been proofread and edited</li>
                                            <li>✓ Content is appropriate for target age group</li>
                                            <li>✓ Copyright compliance verified</li>
                                        </ul>
                                    </div>
                                </div>
                            </div>

                            <!-- Tips & FAQ Tab -->
                            <div class="tab-pane fade" id="help-tips">
                                <h5 class="mb-3"><i class="bi bi-lightbulb"></i> Tips & Best Practices</h5>
                                
                                <h6 class="mt-3 mb-2">Optimization Tips</h6>
                                <ul>
                                    <li><strong>Choose the Right Age Group:</strong> Consider reading level and attention span</li>
                                    <li><strong>Edit AI-Generated Content:</strong> Review and refine text for clarity</li>
                                    <li><strong>Consistent Style:</strong> Generate all images with the same AI backend</li>
                                    <li><strong>Batch Processing:</strong> Generate multiple chapter images in sequence</li>
                                    <li><strong>Save Prompts:</strong> Save good prompts before generating images</li>
                                </ul>

                                <h6 class="mt-4 mb-2">Common Issues & Solutions</h6>
                                <div class="accordion" id="faqAccordion">
                                    <div class="accordion-item">
                                        <h2 class="accordion-header">
                                            <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#faq1">
                                                Images not showing after generation?
                                            </button>
                                        </h2>
                                        <div id="faq1" class="accordion-collapse collapse" data-bs-parent="#faqAccordion">
                                            <div class="accordion-body">
                                                <strong>Solution:</strong> Refresh the page to clear browser cache. Images are cached with timestamps but may need a manual refresh.
                                            </div>
                                        </div>
                                    </div>
                                    
                                    <div class="accordion-item">
                                        <h2 class="accordion-header">
                                            <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#faq2">
                                                Chapter processing taking too long?
                                            </button>
                                        </h2>
                                        <div id="faq2" class="accordion-collapse collapse" data-bs-parent="#faqAccordion">
                                            <div class="accordion-body">
                                                <strong>Solution:</strong> Processing time depends on book length. Books with 20+ chapters may take 3-5 minutes. Be patient and don't refresh the page during processing.
                                            </div>
                                        </div>
                                    </div>
                                    
                                    <div class="accordion-item">
                                        <h2 class="accordion-header">
                                            <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#faq3">
                                                Want to change image backend?
                                            </button>
                                        </h2>
                                        <div id="faq3" class="accordion-collapse collapse" data-bs-parent="#faqAccordion">
                                            <div class="accordion-body">
                                                <strong>Solution:</strong> Go to Settings and change the "Default Image Backend". Configure API keys if switching to a new service. Settings persist across sessions.
                                            </div>
                                        </div>
                                    </div>
                                    
                                    <div class="accordion-item">
                                        <h2 class="accordion-header">
                                            <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#faq4">
                                                How to ensure copyright compliance?
                                            </button>
                                        </h2>
                                        <div id="faq4" class="accordion-collapse collapse" data-bs-parent="#faqAccordion">
                                            <div class="accordion-body">
                                                <strong>Solution:</strong> Only use books that are:
                                                <ul>
                                                    <li>In the public domain (published before 1928 in most cases)</li>
                                                    <li>From Project Gutenberg (all public domain)</li>
                                                    <li>Licensed for adaptation (get written permission)</li>
                                                </ul>
                                                You are solely responsible for copyright compliance.
                                            </div>
                                        </div>
                                    </div>
                                    
                                    <div class="accordion-item">
                                        <h2 class="accordion-header">
                                            <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#faq5">
                                                Can I edit the adapted text?
                                            </button>
                                        </h2>
                                        <div id="faq5" class="accordion-collapse collapse" data-bs-parent="#faqAccordion">
                                            <div class="accordion-body">
                                                <strong>Yes!</strong> All chapter text is editable. Click on any chapter text field, make your changes, and they're automatically saved. This allows you to refine AI-generated content.
                                            </div>
                                        </div>
                                    </div>
                                </div>

                                <h6 class="mt-4 mb-2">Keyboard Shortcuts</h6>
                                <table class="table table-sm">
                                    <tbody>
                                        <tr>
                                            <td><code>Ctrl/Cmd + S</code></td>
                                            <td>Save current changes (when editing)</td>
                                        </tr>
                                        <tr>
                                            <td><code>Esc</code></td>
                                            <td>Close modal windows</td>
                                        </tr>
                                        <tr>
                                            <td><code>Ctrl/Cmd + P</code></td>
                                            <td>Print preview page</td>
                                        </tr>
                                    </tbody>
                                </table>

                                <div class="alert alert-info mt-4">
                                    <i class="bi bi-envelope"></i>
                                    <strong>Need More Help?</strong> Contact support through <a href="https://digitalgods.ai" target="_blank">DigitalGods.ai</a> for technical assistance.
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Bootstrap JS Bundle -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    
    <!-- Custom JS -->
    <script>
        // Set current year for copyright
        document.getElementById('copyright-year').textContent = new Date().getFullYear();
        
        // Set current date for terms and privacy
        const currentDate = new Date().toLocaleDateString('en-US', { 
            year: 'numeric', 
            month: 'long', 
            day: 'numeric' 
        });
        const termsDateEl = document.getElementById('terms-date');
        const privacyDateEl = document.getElementById('privacy-date');
        if (termsDateEl) termsDateEl.textContent = currentDate;
        if (privacyDateEl) privacyDateEl.textContent = currentDate;
        
        // HTMX event handlers
        document.body.addEventListener('htmx:afterRequest', function(event) {
            // Handle successful responses
            if (event.detail.successful) {
                // Check for success messages
                const response = event.detail.xhr.response;
                if (response.includes('success')) {
                    showToast('Success', 'Operation completed successfully', 'success');
                }
            }
        });

        // Toast notification function
        function showToast(title, message, type = 'info') {
            const toastEl = document.getElementById('liveToast');
            const toastHeader = toastEl.querySelector('.toast-header strong');
            const toastBody = toastEl.querySelector('.toast-body');
            const toastIcon = toastEl.querySelector('.toast-header i');
            
            // Update content
            toastHeader.textContent = title;
            toastBody.textContent = message;
            
            // Update icon based on type
            toastIcon.className = `bi me-2 ${
                type === 'success' ? 'bi-check-circle-fill text-success' :
                type === 'error' ? 'bi-x-circle-fill text-danger' :
                type === 'warning' ? 'bi-exclamation-triangle-fill text-warning' :
                'bi-info-circle-fill text-primary'
            }`;
            
            // Show toast
            const toast = new bootstrap.Toast(toastEl);
            toast.show();
        }

        // Initialize tooltips
        const tooltipTriggerList = document.querySelectorAll('[data-bs-toggle="tooltip"]');
        const tooltipList = [...tooltipTriggerList].map(tooltipTriggerEl => new bootstrap.Tooltip(tooltipTriggerEl));

        // Theme System - 3 themes: system (default), dark, charcoal
        const themes = ['system', 'dark', 'charcoal'];
        const themeIcons = {
            'system': 'bi-circle-half',           // Half moon for system theme
            'dark': 'bi-moon-stars-fill',         // Full moon with stars for dark
            'charcoal': 'bi-moon-fill'            // Solid moon for charcoal
        };
        
        function getStoredTheme() {
            return localStorage.getItem('theme') || 'system';
        }
        
        function setStoredTheme(theme) {
            localStorage.setItem('theme', theme);
        }
        
        function getSystemTheme() {
            return window.matchMedia('(prefers-color-scheme: dark)').matches ? 'dark' : 'light';
        }
        
        function applyTheme(theme) {
            // Remove all theme classes
            document.documentElement.removeAttribute('data-bs-theme');
            document.body.classList.remove('theme-system', 'theme-dark', 'theme-charcoal');
            
            if (theme === 'system') {
                // Use system preference
                const systemTheme = getSystemTheme();
                document.documentElement.setAttribute('data-bs-theme', systemTheme);
                document.body.classList.add('theme-system');
            } else if (theme === 'dark') {
                // Pure dark theme (black background)
                document.documentElement.setAttribute('data-bs-theme', 'dark');
                document.body.classList.add('theme-dark');
            } else if (theme === 'charcoal') {
                // Charcoal theme (dark gray background)
                document.documentElement.setAttribute('data-bs-theme', 'dark');
                document.body.classList.add('theme-charcoal');
            }
            
            // Update icon
            const themeIcon = document.getElementById('themeIcon');
            if (themeIcon) {
                // Remove all icon classes
                themeIcon.className = '';
                // Add new icon class
                themeIcon.classList.add('bi', themeIcons[theme]);
            }
        }
        
        function cycleTheme() {
            const currentTheme = getStoredTheme();
            const currentIndex = themes.indexOf(currentTheme);
            const nextIndex = (currentIndex + 1) % themes.length;
            const nextTheme = themes[nextIndex];
            
            setStoredTheme(nextTheme);
            applyTheme(nextTheme);
            
            // Show toast notification
            showThemeToast(nextTheme);
        }
        
        function showThemeToast(theme) {
            const themeNames = {
                'system': 'System Theme',
                'dark': 'Dark Theme',
                'charcoal': 'Charcoal Theme'
            };
            
            const toast = document.getElementById('liveToast');
            if (toast) {
                const toastBody = toast.querySelector('.toast-body');
                if (toastBody) {
                    toastBody.textContent = `Switched to ${themeNames[theme]}`;
                }
                const bsToast = new bootstrap.Toast(toast);
                bsToast.show();
            }
        }
        
        // Initialize theme on page load
        applyTheme(getStoredTheme());
        
        // Listen for system theme changes
        window.matchMedia('(prefers-color-scheme: dark)').addEventListener('change', () => {
            if (getStoredTheme() === 'system') {
                applyTheme('system');
            }
        });
        
        // Attach theme toggle to button
        document.getElementById('themeToggle')?.addEventListener('click', (e) => {
            e.preventDefault();
            cycleTheme();
        });
    </script>
    
    {% block extra_js %}{% endblock %}
</body>
</html>
